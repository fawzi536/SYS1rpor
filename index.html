<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø®Ø¯Ù…Ø§Øª Ø¨ÙˆØ±ØªØ±Ø§Ø¬</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
    
    * {
      font-family: 'Cairo', sans-serif;
      font-size: 14px;
    }
    
    html, body {
      height: 100%;
      overflow: hidden;
      margin: 0;
      padding: 0;
    }
    
    .dashboard-wrapper {
      height: 100%;
      width: 100%;
      display: flex;
      background: #0a0a0a;
      overflow: hidden;
    }
    
    /* Sidebar */
    .sidebar {
      width: 260px;
      background: linear-gradient(180deg, #1a1a1a 0%, #0f0f0f 100%);
      border-left: 2px solid #F2BC1B;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      padding: 12px;
      gap: 8px;
    }
    
    .sidebar::-webkit-scrollbar {
      width: 6px;
    }
    
    .sidebar::-webkit-scrollbar-track {
      background: #1a1a1a;
    }
    
    .sidebar::-webkit-scrollbar-thumb {
      background: #F2BC1B;
      border-radius: 3px;
    }
    
    .logo-section {
      text-align: center;
      padding: 8px 0 12px 0;
      border-bottom: 1px solid #333;
      margin-bottom: 8px;
    }
    
    .logo-section img {
      max-width: 60px;
      height: auto;
      margin: 0 auto 6px;
    }
    
    .logo-section h1 {
      font-size: 16px;
      font-weight: 700;
      color: #F2BC1B;
      margin: 0;
    }
    
    .service-item {
      background: #262626;
      border: 1px solid #404040;
      border-radius: 6px;
      padding: 10px 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .service-item:hover {
      background: #333;
      border-color: #F2BC1B;
      transform: translateX(-2px);
    }
    
    .service-item.active {
      background: linear-gradient(135deg, #F2BC1B 0%, #d9a616 100%);
      border-color: #F2BC1B;
      color: #000;
      font-weight: 600;
    }
    
    .service-item .icon {
      font-size: 20px;
      width: 24px;
      text-align: center;
    }
    
    .service-item .label {
      flex: 1;
      font-size: 13px;
      color: #fff;
    }
    
    .service-item.active .label {
      color: #000;
    }
    
    /* Main Content */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background: #0a0a0a;
    }
    
    /* Header Bar */
    .header-bar {
      background: #1a1a1a;
      border-bottom: 2px solid #F2BC1B;
      padding: 10px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .header-bar h2 {
      font-size: 18px;
      font-weight: 700;
      color: #F2BC1B;
      margin: 0;
    }
    
    .header-bar .status {
      font-size: 12px;
      color: #10b981;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      background: #10b981;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    /* Content Area */
    .content-area {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: auto auto 1fr;
      gap: 12px;
      align-content: start;
    }
    
    .content-area::-webkit-scrollbar {
      width: 8px;
    }
    
    .content-area::-webkit-scrollbar-track {
      background: #1a1a1a;
    }
    
    .content-area::-webkit-scrollbar-thumb {
      background: #F2BC1B;
      border-radius: 4px;
    }
    
    /* Form Sections */
    .form-section {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 6px;
      padding: 12px;
    }
    
    .form-section.full-width {
      grid-column: 1 / -1;
    }
    
    .section-title {
      font-size: 13px;
      font-weight: 700;
      color: #F2BC1B;
      margin: 0 0 10px 0;
      padding-bottom: 6px;
      border-bottom: 1px solid #333;
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
    }
    
    .form-field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    
    .form-field label {
      font-size: 12px;
      color: #999;
      font-weight: 600;
    }
    
    .form-control {
      background: #262626;
      border: 1px solid #404040;
      border-radius: 4px;
      padding: 6px 10px;
      color: #fff;
      font-size: 13px;
      transition: all 0.2s ease;
    }
    
    .form-control:focus {
      outline: none;
      border-color: #F2BC1B;
      background: #2d2d2d;
    }
    
    .form-control::placeholder {
      color: #666;
    }
    
    /* Buttons */
    .btn-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin-top: 8px;
    }
    
    .btn-option {
      background: #262626;
      border: 1px solid #404040;
      border-radius: 4px;
      padding: 8px 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
      font-size: 12px;
      color: #fff;
    }
    
    .btn-option:hover {
      background: #333;
      border-color: #F2BC1B;
    }
    
    .btn-option.active {
      background: #F2BC1B;
      border-color: #F2BC1B;
      color: #000;
      font-weight: 600;
    }
    
    /* Data Table */
    .data-table-container {
      grid-column: 1 / -1;
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 6px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      max-height: 400px;
    }
    
    .table-header {
      background: #F2BC1B;
      padding: 8px 12px;
      font-size: 13px;
      font-weight: 700;
      color: #000;
    }
    
    .table-scroll {
      overflow-y: auto;
      max-height: 350px;
    }
    
    .table-scroll::-webkit-scrollbar {
      width: 6px;
    }
    
    .table-scroll::-webkit-scrollbar-track {
      background: #262626;
    }
    
    .table-scroll::-webkit-scrollbar-thumb {
      background: #F2BC1B;
      border-radius: 3px;
    }
    
    .data-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .data-table th {
      background: #262626;
      color: #F2BC1B;
      font-size: 12px;
      font-weight: 700;
      padding: 8px 10px;
      text-align: center;
      border-bottom: 1px solid #404040;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    .data-table td {
      padding: 6px 10px;
      font-size: 12px;
      color: #ccc;
      text-align: center;
      border-bottom: 1px solid #333;
    }
    
    .data-table tr:hover td {
      background: #262626;
    }
    
    .data-table .highlight {
      color: #F2BC1B;
      font-weight: 600;
    }
    
    /* Info Boxes */
    .info-box {
      background: #1a3a52;
      border: 1px solid #3b82f6;
      border-radius: 4px;
      padding: 8px 10px;
      font-size: 12px;
      color: #93c5fd;
      margin-top: 8px;
    }
    
    .warning-box {
      background: #4a3a1a;
      border: 1px solid #f59e0b;
      border-radius: 4px;
      padding: 8px 10px;
      font-size: 12px;
      color: #fbbf24;
      margin-top: 8px;
    }
    
    .error-box {
      background: #4a1a1a;
      border: 1px solid #ef4444;
      border-radius: 4px;
      padding: 8px 10px;
      font-size: 12px;
      color: #fca5a5;
      margin-top: 8px;
    }
    
    /* Loading */
    .spinner {
      border: 2px solid #333;
      border-top: 2px solid #F2BC1B;
      border-radius: 50%;
      width: 16px;
      height: 16px;
      animation: spin 1s linear infinite;
      display: inline-block;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .hidden {
      display: none !important;
    }
    
    /* Wash Cards Compact */
    .wash-cards-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
    
    .wash-card-compact {
      background: #262626;
      border: 1px solid #404040;
      border-radius: 4px;
      padding: 10px;
      transition: all 0.2s ease;
    }
    
    .wash-card-compact:hover {
      border-color: #F2BC1B;
      transform: translateY(-2px);
    }
    
    .wash-card-compact h3 {
      font-size: 13px;
      color: #F2BC1B;
      margin: 0 0 6px 0;
      font-weight: 700;
    }
    
    .wash-card-compact .price {
      font-size: 12px;
      color: #fff;
      font-weight: 600;
      margin-bottom: 6px;
    }
    
    .wash-card-compact ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .wash-card-compact li {
      font-size: 11px;
      color: #999;
      padding: 2px 0 2px 12px;
      position: relative;
    }
    
    .wash-card-compact li:before {
      content: "âœ“";
      position: absolute;
      right: 0;
      color: #10b981;
      font-weight: bold;
      font-size: 10px;
    }
    
    /* Copy Button */
    .copy-btn-small {
      background: #F2BC1B;
      color: #000;
      border: none;
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      margin-top: 6px;
      transition: all 0.2s ease;
    }
    
    .copy-btn-small:hover {
      background: #d9a616;
    }
    
    .copy-btn-small.success {
      background: #10b981;
      color: #fff;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div class="dashboard-wrapper"><!-- Sidebar -->
   <aside class="sidebar">
    <div class="logo-section"><img src="https://i.top4top.io/p_35860o72q1.png" alt="Logo">
     <h1 id="siteTitle">Ø®Ø¯Ù…Ø§Øª Ø¨ÙˆØ±ØªØ±Ø§Ø¬</h1>
    </div>
    <div class="service-item" data-service="tow"><span class="icon">ğŸšš</span> <span class="label">ÙˆÙ†Ø´Ø§Øª</span>
    </div>
    <div class="service-item" data-service="battery"><span class="icon">ğŸ”‹</span> <span class="label">Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ø·Ø§Ø±ÙŠØ©</span>
    </div>
    <div class="service-item" data-service="batteryInstall"><span class="icon">ğŸ”§</span> <span class="label">ØªØ±ÙƒÙŠØ¨ Ø¨Ø·Ø§Ø±ÙŠØ©</span>
    </div>
    <div class="service-item" data-service="fuel"><span class="icon">â›½</span> <span class="label">Ø®Ø¯Ù…Ø© Ø¨Ù†Ø²ÙŠÙ†</span>
    </div>
    <div class="service-item" data-service="tire"><span class="icon">ğŸ›</span> <span class="label">Ø®Ø¯Ù…Ø© Ø¨Ù†Ø´Ø±</span>
    </div>
    <div class="service-item" data-service="balance"><span class="icon">âš–ï¸</span> <span class="label">Ù…ÙŠØ²Ø§Ù† ÙˆØªØ±ÙƒÙŠØ¨</span>
    </div>
    <div class="service-item" data-service="mechanical"><span class="icon">ğŸ”©</span> <span class="label">Ø®Ø¯Ù…Ø§Øª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©</span>
    </div>
    <div class="service-item" data-service="carwash"><span class="icon">ğŸ’¦</span> <span class="label">ØºØ³ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</span>
    </div>
   </aside><!-- Main Content -->
   <main class="main-content"><!-- Header Bar -->
    <header class="header-bar">
     <h2 id="serviceTitle">Ø§Ø®ØªØ± Ø®Ø¯Ù…Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h2>
     <div class="status"><span class="status-dot"></span> <span>Ù…ØªØµÙ„</span>
     </div>
    </header><!-- Loading State -->
    <div id="initialLoading" class="content-area" style="display: flex; align-items: center; justify-content: center;">
     <div style="text-align: center;">
      <div class="spinner" style="width: 32px; height: 32px; border-width: 3px; margin: 0 auto 12px;"></div>
      <p style="color: #999; font-size: 14px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
     </div>
    </div><!-- Content Area -->
    <div id="contentArea" class="content-area hidden"><!-- Dynamic content will be inserted here -->
    </div>
   </main>
  </div>
  <script>
    // Configuration
    const defaultConfig = {
      site_title: 'Ø®Ø¯Ù…Ø§Øª Ø¨ÙˆØ±ØªØ±Ø§Ø¬',
      sheet_id: '1x2ongtstODqEEWh_jAwN8zLHjsYeIppk8EH_Q1CXMzk',
      currency: 'Ø¯.Ùƒ'
    };

    let config = { ...defaultConfig };
    let sheetsData = {};
    let currentService = '';
    let formData = {};
    let carWashData = [];

    // Initialize Element SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (newConfig) => {
          config = { ...defaultConfig, ...newConfig };
          document.getElementById('siteTitle').textContent = config.site_title;
          
          if (newConfig.sheet_id && newConfig.sheet_id !== sheetsData.currentSheetId) {
            await loadAllSheets();
          }
        },
        mapToCapabilities: () => ({
          recolorables: [],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (cfg) => new Map([
          ['site_title', cfg.site_title || defaultConfig.site_title],
          ['sheet_id', cfg.sheet_id || defaultConfig.sheet_id],
          ['currency', cfg.currency || defaultConfig.currency]
        ])
      });
    }

    // Company mapping
    const companyMapping = {
      'Ø¨ÙˆØ±ØªØ±Ø§Ø¬': 'portarage towtruk',
      'Ù‡ÙŠØ±Ùˆ ÙˆØ±ÙƒØ³': 'hero.works',
      'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù†Ù…': 'Ahmed Al-Ghanem',
      'Ø¨ÙŠÙƒÙˆÙƒ ÙƒÙˆÙ†Ø³ÙŠØ±Ø¬': 'Peacock Concierge',
      'Ø¨Ø±ÙˆØ¬ÙƒØª Ø¥ÙƒØ³ Ø±ÙŠØ³Ù†Ù‚': 'ProjX Racing',
      'ÙŠØ§Ù…Ø§Ù‡Ø§ Ù…ÙˆØªÙˆØ±': 'Yamaha Motor',
      'ÙÙˆÙ„Øª Ù‚Ø§Ø±Ø§Ø¬': 'Vault Garage',
      'Ø¬ÙŠÙ„ÙŠ': 'Geely',
      'Ø§ÙˆØªÙˆ ÙƒØ§Ø¨ÙŠØªØ§Ù„': 'Auto Capital'
    };
    
    const companies = Object.keys(companyMapping);

    // Parse CSV
    function parseCSV(csvText) {
      const rows = [];
      const lines = csvText.split('\n');
      
      for (let line of lines) {
        if (!line.trim()) continue;
        
        const cells = [];
        let cell = '';
        let inQuotes = false;
        
        for (let i = 0; i < line.length; i++) {
          const char = line[i];
          
          if (char === '"') {
            if (inQuotes && line[i + 1] === '"') {
              cell += '"';
              i++;
            } else {
              inQuotes = !inQuotes;
            }
          } else if (char === ',' && !inQuotes) {
            cells.push(cell.replace(/^"|"$/g, ''));
            cell = '';
          } else {
            cell += char;
          }
        }
        cells.push(cell.replace(/^"|"$/g, ''));
        rows.push(cells);
      }
      
      return rows;
    }

    // Load all sheets
    async function loadAllSheets() {
      try {
        const sheetId = config.sheet_id;
        
        const sheetNames = [
          'portarage towtruk',
          'hero.works',
          'Ahmed Al-Ghanem',
          'Peacock Concierge',
          'ProjX Racing',
          'Yamaha Motor',
          'Vault Garage',
          'Geely',
          'Auto Capital',
          'Ø®Ø¯Ù…Ø§Øª5',
          'Ù…ÙŠØ²Ø§Ù† ÙˆØªØ±ÙƒÙŠØ¨',
          'Ø®Ø¯Ù…Ø§Øª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©',
          'ØªØ±ÙƒÙŠØ¨ Ø¨Ø·Ø§Ø±ÙŠØ©'
        ];
        
        sheetsData = { currentSheetId: sheetId };
        
        for (const sheetName of sheetNames) {
          try {
            const csvUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(sheetName)}`;
            const response = await fetch(csvUrl);
            
            if (response.ok) {
              const csvText = await response.text();
              const rows = parseCSV(csvText);
              sheetsData[sheetName] = rows;
            }
          } catch (err) {
            console.log(`Could not load sheet: ${sheetName}`);
          }
        }
        
        document.getElementById('initialLoading').classList.add('hidden');
        document.getElementById('contentArea').classList.remove('hidden');
        
      } catch (error) {
        document.getElementById('initialLoading').innerHTML = `
          <div style="text-align: center;">
            <p class="error-box" style="display: inline-block;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
          </div>
        `;
      }
    }

    // Service Selection
    document.addEventListener('click', (e) => {
      const serviceItem = e.target.closest('.service-item');
      if (serviceItem) {
        document.querySelectorAll('.service-item').forEach(item => {
          item.classList.remove('active');
        });
        
        serviceItem.classList.add('active');
        
        currentService = serviceItem.dataset.service;
        formData = {};
        
        const serviceTitles = {
          'tow': 'Ø®Ø¯Ù…Ø© ÙˆÙ†Ø´Ø§Øª',
          'battery': 'Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ø·Ø§Ø±ÙŠØ©',
          'batteryInstall': 'ØªØ±ÙƒÙŠØ¨ Ø¨Ø·Ø§Ø±ÙŠØ©',
          'fuel': 'Ø®Ø¯Ù…Ø© Ø¨Ù†Ø²ÙŠÙ†',
          'tire': 'Ø®Ø¯Ù…Ø© Ø¨Ù†Ø´Ø±',
          'balance': 'Ù…ÙŠØ²Ø§Ù† ÙˆØªØ±ÙƒÙŠØ¨',
          'mechanical': 'Ø®Ø¯Ù…Ø§Øª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©',
          'carwash': 'ØºØ³ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª'
        };
        
        document.getElementById('serviceTitle').textContent = serviceTitles[currentService];
        
        switch(currentService) {
          case 'tow':
            renderTowInterface();
            break;
          case 'battery':
            renderBatteryInterface();
            break;
          case 'batteryInstall':
            renderBatteryInstallInterface();
            break;
          case 'fuel':
            renderFuelInterface();
            break;
          case 'tire':
            renderTireInterface();
            break;
          case 'balance':
            renderBalanceInterface();
            break;
          case 'mechanical':
            renderMechanicalInterface();
            break;
          case 'carwash':
            renderCarWashInterface();
            break;
        }
      }
    });

    // Render Tow Interface
    function renderTowInterface() {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <div class="form-section">
          <h3 class="section-title">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬Ù‡Ø©</h3>
          <div class="btn-grid">
            ${companies.slice(0, 4).map(company => `
              <button class="btn-option" data-company="${company}">${company}</button>
            `).join('')}
          </div>
          <div class="btn-grid">
            ${companies.slice(4, 8).map(company => `
              <button class="btn-option" data-company="${company}">${company}</button>
            `).join('')}
          </div>
          <div class="btn-grid" style="grid-template-columns: 1fr;">
            ${companies.slice(8).map(company => `
              <button class="btn-option" data-company="${company}">${company}</button>
            `).join('')}
          </div>
        </div>
        
        <div id="towTypeSection" class="form-section hidden">
          <h3 class="section-title">Ù†ÙˆØ¹ Ø§Ù„ÙˆÙ†Ø´</h3>
          <div class="btn-grid" style="grid-template-columns: 1fr 1fr;">
            <button class="btn-option" data-type="normal">ÙˆÙ†Ø´ Ø¹Ø§Ø¯ÙŠ</button>
            <button class="btn-option" data-type="flatbed">ÙˆÙ†Ø´ ÙÙ„ Ø¯Ø§ÙˆÙ†</button>
          </div>
        </div>
        
        <div id="towLocationsSection" class="form-section full-width hidden">
          <h3 class="section-title">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹</h3>
          <div class="form-grid">
            <div class="form-field">
              <label>Ù…Ù† Ø£ÙŠÙ†</label>
              <select id="fromSelect" class="form-control">
                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹</option>
              </select>
            </div>
            <div class="form-field">
              <label>Ø¥Ù„Ù‰ Ø£ÙŠÙ†</label>
              <select id="toSelect" class="form-control" disabled>
                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹</option>
              </select>
            </div>
          </div>
          <div id="extraChargesSection" class="hidden">
            <div class="form-field" style="margin-top: 10px;">
              <label>Ù‡Ù„ Ø§Ù„Ù‚ÙŠØ± Ù…Ø§ ÙŠØªØ¨ÙˆØ´ Ø£Ùˆ Ø§Ù„Ø³ÙŠØ§Ø±Ø© ÙÙŠÙ‡Ø§ Ø­Ø§Ø¯Ø«ØŸ</label>
              <select id="extraChargesSelect" class="form-control">
                <option value="no">Ù„Ø§</option>
                <option value="yes">Ù†Ø¹Ù… (+10 Ø¯.Ùƒ Ø±Ø³ÙˆÙ… Ø¹Ø±Ø¨Ø§Ù†Ø§Øª)</option>
              </select>
            </div>
            <div id="extraChargesNote" class="warning-box hidden">
              <strong>âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> ÙÙŠ Ø­Ø§Ù„ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø®ÙØ±: 5 Ø¯.Ùƒ Ù„ÙƒÙ„ Ù†ØµÙ Ø³Ø§Ø¹Ø© | 10 Ø¯.Ùƒ Ù„ÙƒÙ„ Ø³Ø§Ø¹Ø©
            </div>
          </div>
        </div>
        
        <div id="towResultSection" class="data-table-container hidden">
          <div class="table-header">Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</div>
          <div class="table-scroll">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                  <th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th>
                </tr>
              </thead>
              <tbody id="towResultBody">
              </tbody>
            </table>
          </div>
        </div>
      `;
      
      // Company selection
      document.querySelectorAll('[data-company]').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('[data-company]').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          
          formData.companyArabic = btn.dataset.company;
          formData.company = companyMapping[btn.dataset.company];
          
          updateTowTypeOptions();
        });
      });
      
      // Set default to Ø¨ÙˆØ±ØªØ±Ø§Ø¬
      const defaultBtn = document.querySelector('[data-company="Ø¨ÙˆØ±ØªØ±Ø§Ø¬"]');
      if (defaultBtn) {
        defaultBtn.click();
      }
    }

    function updateTowTypeOptions() {
      const towTypeSection = document.getElementById('towTypeSection');
      const sheetName = formData.company;
      
      if (!sheetName || !sheetsData[sheetName]) {
        towTypeSection.classList.add('hidden');
        return;
      }
      
      towTypeSection.classList.remove('hidden');
      document.getElementById('towLocationsSection').classList.add('hidden');
      document.getElementById('towResultSection').classList.add('hidden');
      
      // Tow type selection
      document.querySelectorAll('[data-type]').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('[data-type]').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          
          formData.towType = btn.dataset.type;
          updateTowLocations();
        });
      });
    }

    function updateTowLocations() {
      const towLocationsSection = document.getElementById('towLocationsSection');
      towLocationsSection.classList.remove('hidden');
      
      const routes = getTowRoutes(formData.company, formData.towType);
      const fromLocations = [...new Set(routes.map(r => r.from))].filter(Boolean);
      
      const fromSelect = document.getElementById('fromSelect');
      fromSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹</option>' + 
        fromLocations.map(loc => `<option value="${loc}">${loc}</option>`).join('');
      
      fromSelect.addEventListener('change', () => {
        formData.from = fromSelect.value;
        
        const toSelect = document.getElementById('toSelect');
        if (formData.from) {
          const toLocations = [...new Set(routes.filter(r => r.from === formData.from).map(r => r.to))].filter(Boolean);
          toSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹</option>' + 
            toLocations.map(loc => `<option value="${loc}">${loc}</option>`).join('');
          toSelect.disabled = false;
        } else {
          toSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹</option>';
          toSelect.disabled = true;
        }
        
        document.getElementById('towResultSection').classList.add('hidden');
      });
      
      const toSelect = document.getElementById('toSelect');
      toSelect.addEventListener('change', () => {
        formData.to = toSelect.value;
        
        if (formData.to) {
          if (formData.company && formData.company.toLowerCase() === 'portarage towtruk') {
            document.getElementById('extraChargesSection').classList.remove('hidden');
            
            const extraChargesSelect = document.getElementById('extraChargesSelect');
            formData.extraCharges = 'no';
            
            extraChargesSelect.addEventListener('change', () => {
              formData.extraCharges = extraChargesSelect.value;
              
              if (formData.extraCharges === 'yes') {
                document.getElementById('extraChargesNote').classList.remove('hidden');
              } else {
                document.getElementById('extraChargesNote').classList.add('hidden');
              }
              
              calculateTowPrice();
            });
          }
          
          calculateTowPrice();
        }
      });
    }

    function getTowRoutes(sheetName, towType) {
      const rows = sheetsData[sheetName];
      if (!rows || rows.length < 3) return [];
      
      const routes = [];
      
      for (let i = 2; i < rows.length; i++) {
        const row = rows[i];
        
        if (towType === 'normal') {
          const from = row[6];
          const toF = row[5];
          const toC = row[2];
          const priceE = row[4];
          const priceB = row[1];
          
          if (from && toF && priceE) {
            routes.push({ from, to: toF, price: priceE, cancelCol: 3 });
          }
          if (from && toC && priceB) {
            routes.push({ from, to: toC, price: priceB, cancelCol: 0 });
          }
        } else if (towType === 'flatbed') {
          const from = row[14];
          const toN = row[13];
          const toK = row[10];
          const priceM = row[12];
          const priceJ = row[9];
          
          if (from && toN && priceM) {
            routes.push({ from, to: toN, price: priceM, cancelCol: 11 });
          }
          if (from && toK && priceJ) {
            routes.push({ from, to: toK, price: priceJ, cancelCol: 8 });
          }
        }
      }
      
      return routes;
    }

    function calculateTowPrice() {
      const routes = getTowRoutes(formData.company, formData.towType);
      const route = routes.find(r => r.from === formData.from && r.to === formData.to);
      
      if (!route) return;
      
      let price = parseFloat(route.price) || 0;
      const extraCharges = (formData.company && formData.company.toLowerCase() === 'portarage towtruk' && formData.extraCharges === 'yes') ? 10 : 0;
      
      let cancellationFee = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
      if (formData.company.toLowerCase() === 'portarage towtruk') {
        const rows = sheetsData['portarage towtruk'];
        if (rows && rows.length > 2) {
          for (let i = 2; i < rows.length; i++) {
            const row = rows[i];
            
            if (formData.towType === 'normal') {
              const from = row[6];
              if (from === formData.from) {
                const toF = row[5];
                const toC = row[2];
                if ((toF === formData.to && parseFloat(row[4]) === price) || (toC === formData.to && parseFloat(row[1]) === price)) {
                  const cancelValue = (toF === formData.to) ? row[3] : row[0];
                  if (cancelValue) cancellationFee = `${parseFloat(cancelValue).toFixed(2)} ${config.currency}`;
                  break;
                }
              }
            } else if (formData.towType === 'flatbed') {
              const from = row[14];
              if (from === formData.from) {
                const toN = row[13];
                const toK = row[10];
                if ((toN === formData.to && parseFloat(row[12]) === price) || (toK === formData.to && parseFloat(row[9]) === price)) {
                  const cancelValue = (toN === formData.to) ? row[11] : row[8];
                  if (cancelValue) cancellationFee = `${parseFloat(cancelValue).toFixed(2)} ${config.currency}`;
                  break;
                }
              }
            }
          }
        }
      }
      
      const tbody = document.getElementById('towResultBody');
      let rows = `
        <tr>
          <td>Ø³Ø¹Ø± ${formData.companyArabic}</td>
          <td class="highlight">${price.toFixed(2)} ${config.currency}</td>
        </tr>
      `;
      
      if (extraCharges > 0) {
        const total = price + extraCharges;
        rows += `
          <tr>
            <td>Ø±Ø³ÙˆÙ… Ø¹Ø±Ø¨Ø§Ù†Ø§Øª</td>
            <td class="highlight">${extraCharges.toFixed(2)} ${config.currency}</td>
          </tr>
          <tr style="background: #262626;">
            <td><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</strong></td>
            <td class="highlight"><strong>${total.toFixed(2)} ${config.currency}</strong></td>
          </tr>
        `;
      }
      
      rows += `
        <tr>
          <td>Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</td>
          <td>${cancellationFee}</td>
        </tr>
      `;
      
      tbody.innerHTML = rows;
      document.getElementById('towResultSection').classList.remove('hidden');
    }

    // Render Battery Interface
    function renderBatteryInterface() {
      renderServiceInterface('Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ø·Ø§Ø±ÙŠØ©', 'Ø®Ø¯Ù…Ø§Øª5', [0, 1, 2, 4, 5, 6], 
        '<div class="info-box">ÙÙŠ Ø­Ø§Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠØ¨ÙŠ ÙØ­Øµ Ø¨Ø·Ø§Ø±ÙŠØ©: 10 Ø¯.Ùƒ ØªÙ†Ø®ØµÙ… Ù…Ù† Ø³Ø¹Ø± Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©</div>');
    }

    // Render Battery Install Interface
    function renderBatteryInstallInterface() {
      renderServiceInterface('ØªØ±ÙƒÙŠØ¨ Ø¨Ø·Ø§Ø±ÙŠØ©', 'ØªØ±ÙƒÙŠØ¨ Ø¨Ø·Ø§Ø±ÙŠØ©', [0, 1, 2, 4, 5, 6],
        '<div class="info-box">Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¹Ø± ÙÙ‚Ø· Ø¥Ø°Ø§ Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø¹Ù…ÙŠÙ„</div>');
    }

    // Render Fuel Interface
    function renderFuelInterface() {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <div class="form-section">
          <h3 class="section-title">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</h3>
          <div class="form-field">
            <select id="areaSelect" class="form-control">
              <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</option>
            </select>
          </div>
        </div>
        
        <div id="fuelTypeSection" class="form-section hidden">
          <h3 class="section-title">Ù†ÙˆØ¹ Ø§Ù„Ø¨Ù†Ø²ÙŠÙ†</h3>
          <div class="btn-grid" style="grid-template-columns: repeat(3, 1fr);">
            <button class="btn-option" data-fuel="premium">Ø¨Ù†Ø²ÙŠÙ† Ù…Ù…ØªØ§Ø²<br><small>(1.5 Ø¯.Ùƒ)</small></button>
            <button class="btn-option" data-fuel="special">Ø¨Ù†Ø²ÙŠÙ† Ø®ØµÙˆØµÙŠ<br><small>(1.5 Ø¯.Ùƒ)</small></button>
            <button class="btn-option" data-fuel="ultra">Ø¨Ù†Ø²ÙŠÙ† Ø§Ù„ØªØ±Ø§<br><small>(2.5 Ø¯.Ùƒ)</small></button>
          </div>
        </div>
        
        <div id="fuelResultSection" class="data-table-container hidden">
          <div class="table-header">Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</div>
          <div class="table-scroll">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                  <th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th>
                </tr>
              </thead>
              <tbody id="fuelResultBody">
              </tbody>
            </table>
          </div>
          <div class="warning-box">
            <strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ù„Ø§Ø²Ù… ØªØ´Ø±Ø­ÙˆÙ† Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù†Ù‡ Ø±Ø³ÙˆÙ… Ø§Ù„Ø®Ø¯Ù…Ù‡ Ù…Ù†ÙØµÙ„Ø© Ø¹Ù† Ø³Ø¹Ø± Ø§Ù„Ø¨Ù†Ø²ÙŠÙ† ÙˆØ§Ù†Ù‡ ÙŠÙˆØµÙ„Ù‡ Ù„Ø§Ù‚Ø±Ø¨ Ù…Ø­Ø·Ù‡ ÙÙ‚Ø·
          </div>
        </div>
      `;
      
      loadAreaOptions('Ø®Ø¯Ù…Ø§Øª5', [0, 1, 2, 4, 5, 6], () => {
        document.getElementById('fuelTypeSection').classList.remove('hidden');
        
        document.querySelectorAll('[data-fuel]').forEach(btn => {
          btn.addEventListener('click', () => {
            document.querySelectorAll('[data-fuel]').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            formData.fuelType = btn.dataset.fuel;
            calculateFuelPrice();
          });
        });
      });
    }

    function calculateFuelPrice() {
      const rows = sheetsData['Ø®Ø¯Ù…Ø§Øª5'];
      if (!rows) return;
      
      let servicePrice = 0;
      let cancellation = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
      
      for (let i = 2; i < rows.length; i++) {
        const row = rows[i];
        if (row[0] === formData.area) {
          servicePrice = parseFloat(row[1]) || 0;
          cancellation = row[2] ? `${parseFloat(row[2]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
          break;
        } else if (row[4] === formData.area) {
          servicePrice = parseFloat(row[5]) || 0;
          cancellation = row[6] ? `${parseFloat(row[6]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
          break;
        }
      }
      
      const fuelPrices = { 'premium': 1.5, 'special': 1.5, 'ultra': 2.5 };
      const fuelPrice = fuelPrices[formData.fuelType] || 1.5;
      const total = servicePrice + fuelPrice;
      
      const fuelNames = { 'premium': 'Ø¨Ù†Ø²ÙŠÙ† Ù…Ù…ØªØ§Ø²', 'special': 'Ø¨Ù†Ø²ÙŠÙ† Ø®ØµÙˆØµÙŠ', 'ultra': 'Ø¨Ù†Ø²ÙŠÙ† Ø§Ù„ØªØ±Ø§' };
      
      const tbody = document.getElementById('fuelResultBody');
      tbody.innerHTML = `
        <tr>
          <td>Ø±Ø³ÙˆÙ… Ø®Ø¯Ù…Ø© Ø§Ù„ØªÙˆØµÙŠÙ„</td>
          <td class="highlight">${servicePrice.toFixed(2)} ${config.currency}</td>
        </tr>
        <tr>
          <td>Ù†ÙˆØ¹ Ø§Ù„Ø¨Ù†Ø²ÙŠÙ†</td>
          <td>${fuelNames[formData.fuelType]}</td>
        </tr>
        <tr>
          <td>Ø³Ø¹Ø± Ø§Ù„Ø¨Ù†Ø²ÙŠÙ†</td>
          <td class="highlight">${fuelPrice.toFixed(2)} ${config.currency}</td>
        </tr>
        <tr style="background: #262626;">
          <td><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</strong></td>
          <td class="highlight"><strong>${total.toFixed(2)} ${config.currency}</strong></td>
        </tr>
        <tr>
          <td>Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</td>
          <td>${cancellation}</td>
        </tr>
      `;
      
      document.getElementById('fuelResultSection').classList.remove('hidden');
    }

    // Render Tire Interface
    function renderTireInterface() {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <div class="form-section full-width">
          <h3 class="section-title">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</h3>
          <div class="form-field">
            <select id="areaSelect" class="form-control">
              <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</option>
            </select>
          </div>
        </div>
        
        <div id="tireResultSection" class="data-table-container hidden">
          <div class="table-header">Ø£Ø³Ø¹Ø§Ø± Ø®Ø¯Ù…Ø© Ø§Ù„Ø¨Ù†Ø´Ø±</div>
          <div class="table-scroll">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</th>
                  <th>Ø§Ù„Ø³Ø¹Ø±</th>
                  <th>Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</th>
                </tr>
              </thead>
              <tbody id="tireResultBody">
              </tbody>
            </table>
          </div>
        </div>
      `;
      
      loadAreaOptions('Ø®Ø¯Ù…Ø§Øª5', [0, 1, 2, 4, 5, 6, 8, 9, 10, 12, 13, 14], () => {
        calculateTirePrice();
      });
    }

    function calculateTirePrice() {
      const rows = sheetsData['Ø®Ø¯Ù…Ø§Øª5'];
      if (!rows) return;
      
      let externalPrice = 'ØºÙŠØ± Ù…ØªÙˆÙØ±', externalCancel = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
      let internalPrice = 'ØºÙŠØ± Ù…ØªÙˆÙØ±', internalCancel = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
      
      for (let i = 2; i < rows.length; i++) {
        const row = rows[i];
        
        if (row[0] === formData.area) {
          externalPrice = row[1] ? `${parseFloat(row[1]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
          externalCancel = row[2] ? `${parseFloat(row[2]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        } else if (row[4] === formData.area) {
          externalPrice = row[5] ? `${parseFloat(row[5]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
          externalCancel = row[6] ? `${parseFloat(row[6]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        }
        
        if (row[8] === formData.area) {
          internalPrice = row[9] ? `${parseFloat(row[9]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
          internalCancel = row[10] ? `${parseFloat(row[10]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        } else if (row[12] === formData.area) {
          internalPrice = row[13] ? `${parseFloat(row[13]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
          internalCancel = row[14] ? `${parseFloat(row[14]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        }
      }
      
      const tbody = document.getElementById('tireResultBody');
      tbody.innerHTML = `
        <tr>
          <td>Ø±Ù‚Ø¹Ø© Ø®Ø§Ø±Ø¬ÙŠØ© / ØªØ±ÙƒÙŠØ¨ Ø³Ø¨ÙŠØ± / ØªØ¹Ø¨Ø¦Ø© Ù‡ÙˆØ§Ø¡</td>
          <td class="highlight">${externalPrice}</td>
          <td>${externalCancel}</td>
        </tr>
        <tr>
          <td>Ø±Ù‚Ø¹Ø© Ø¯Ø§Ø®Ù„ÙŠØ©</td>
          <td class="highlight">${internalPrice}</td>
          <td>${internalCancel}</td>
        </tr>
      `;
      
      document.getElementById('tireResultSection').classList.remove('hidden');
    }

    // Render Balance Interface
    function renderBalanceInterface() {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <div class="form-section">
          <h3 class="section-title">Ù…ØµØ¯Ø± Ø§Ù„ØªÙˆØ§ÙŠØ±</h3>
          <div class="btn-grid" style="grid-template-columns: 1fr 1fr;">
            <button class="btn-option" data-source="ours">Ù…Ù† Ø¹Ù†Ø¯Ù†Ø§</button>
            <button class="btn-option" data-source="customer">Ù…Ù† Ø¹Ù†Ø¯ Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
          </div>
        </div>
        
        <div id="balanceAreaSection" class="form-section hidden">
          <h3 class="section-title">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</h3>
          <div class="form-field">
            <select id="areaSelect" class="form-control">
              <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</option>
            </select>
          </div>
        </div>
        
        <div id="tireCountSection" class="form-section hidden">
          <h3 class="section-title">Ø¹Ø¯Ø¯ Ø§Ù„ØªÙˆØ§ÙŠØ±</h3>
          <div class="form-field">
            <input type="number" id="tireCountInput" class="form-control" min="1" max="10" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„ØªÙˆØ§ÙŠØ±">
          </div>
        </div>
        
        <div id="balanceResultSection" class="data-table-container hidden">
          <div class="table-header">Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</div>
          <div class="table-scroll">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                  <th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th>
                </tr>
              </thead>
              <tbody id="balanceResultBody">
              </tbody>
            </table>
          </div>
          <div id="balanceNote" class="info-box hidden"></div>
        </div>
      `;
      
      document.querySelectorAll('[data-source]').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('[data-source]').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          
          formData.tireSource = btn.dataset.source;
          
          document.getElementById('balanceAreaSection').classList.remove('hidden');
          
          if (formData.tireSource === 'ours') {
            document.getElementById('tireCountSection').classList.add('hidden');
            loadAreaOptions('Ù…ÙŠØ²Ø§Ù† ÙˆØªØ±ÙƒÙŠØ¨', [0, 1, 2, 4, 5, 6], calculateBalancePrice);
          } else {
            document.getElementById('tireCountSection').classList.remove('hidden');
            loadAreaOptions('Ù…ÙŠØ²Ø§Ù† ÙˆØªØ±ÙƒÙŠØ¨', [8, 9, 10, 12, 13, 14], () => {
              document.getElementById('tireCountInput').addEventListener('input', (e) => {
                formData.tireCount = parseInt(e.target.value) || 0;
                if (formData.tireCount > 0) calculateBalancePrice();
              });
            });
          }
        });
      });
    }

    function calculateBalancePrice() {
      const rows = sheetsData['Ù…ÙŠØ²Ø§Ù† ÙˆØªØ±ÙƒÙŠØ¨'];
      if (!rows) return;
      
      let basePrice = 0;
      let cancellation = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
      
      if (formData.tireSource === 'ours') {
        for (let i = 2; i < rows.length; i++) {
          const row = rows[i];
          if (row[0] === formData.area) {
            basePrice = parseFloat(row[1]) || 0;
            cancellation = row[2] ? `${parseFloat(row[2]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            break;
          } else if (row[4] === formData.area) {
            basePrice = parseFloat(row[5]) || 0;
            cancellation = row[6] ? `${parseFloat(row[6]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            break;
          }
        }
        
        const tbody = document.getElementById('balanceResultBody');
        tbody.innerHTML = `
          <tr>
            <td>Ø³Ø¹Ø± Ø§Ù„Ø®Ø¯Ù…Ø©</td>
            <td class="highlight">${basePrice.toFixed(2)} ${config.currency}</td>
          </tr>
          <tr>
            <td>Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</td>
            <td>${cancellation}</td>
          </tr>
        `;
        
        const noteDiv = document.getElementById('balanceNote');
        noteDiv.textContent = 'Ø§Ù„Ø³Ø¹Ø± Ù‡Ø°Ø§ Ø³ÙˆØ§Ø¡ Ø¨ÙŠØ±ÙƒØ¨ Ù…Ù† ØªØ§ÙŠØ± Ø§Ù„Ù‰ Ø§Ø±Ø¨Ø¹ ØªÙˆØ§ÙŠØ± Ù†ÙØ³ Ø±Ø³ÙˆÙ… Ø§Ù„Ø®Ø¯Ù…Ù‡';
        noteDiv.classList.remove('hidden');
        
      } else {
        for (let i = 2; i < rows.length; i++) {
          const row = rows[i];
          if (row[8] === formData.area) {
            basePrice = parseFloat(row[9]) || 0;
            cancellation = row[10] ? `${parseFloat(row[10]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            break;
          } else if (row[12] === formData.area) {
            basePrice = parseFloat(row[13]) || 0;
            cancellation = row[14] ? `${parseFloat(row[14]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            break;
          }
        }
        
        const tireCount = formData.tireCount || 0;
        const total = basePrice + (tireCount * 5);
        
        const tbody = document.getElementById('balanceResultBody');
        tbody.innerHTML = `
          <tr>
            <td>Ø³Ø¹Ø± Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</td>
            <td class="highlight">${basePrice.toFixed(2)} ${config.currency}</td>
          </tr>
          <tr>
            <td>Ø¹Ø¯Ø¯ Ø§Ù„ØªÙˆØ§ÙŠØ±</td>
            <td>${tireCount}</td>
          </tr>
          <tr>
            <td>Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙˆØ§ÙŠØ± (5 Ø¯.Ùƒ Ã— ${tireCount})</td>
            <td class="highlight">${(tireCount * 5).toFixed(2)} ${config.currency}</td>
          </tr>
          <tr style="background: #262626;">
            <td><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</strong></td>
            <td class="highlight"><strong>${total.toFixed(2)} ${config.currency}</strong></td>
          </tr>
          <tr>
            <td>Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</td>
            <td>${cancellation}</td>
          </tr>
        `;
        
        const noteDiv = document.getElementById('balanceNote');
        noteDiv.textContent = 'Ø¥Ø°Ø§ Ø§Ù„ØªÙˆØ§ÙŠØ± Ù…Ù† Ø¹Ù†Ø¯ Ø§Ù„Ø¹Ù…ÙŠÙ„';
        noteDiv.classList.remove('hidden');
      }
      
      document.getElementById('balanceResultSection').classList.remove('hidden');
    }

    // Render Mechanical Interface
    function renderMechanicalInterface() {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <div class="form-section">
          <h3 class="section-title">Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</h3>
          <div class="btn-grid" style="grid-template-columns: repeat(3, 1fr);">
            <button class="btn-option" data-mech="inspection">ÙØ­Øµ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</button>
            <button class="btn-option" data-mech="oil">Ø²ÙŠØª ÙˆÙÙ„ØªØ±</button>
            <button class="btn-option" data-mech="brakes">Ø³ÙØ§ÙŠÙ ÙˆØ¯ÙŠØ³ÙƒØ§Øª</button>
          </div>
        </div>
        
        <div id="mechAreaSection" class="form-section hidden">
          <h3 class="section-title">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</h3>
          <div class="form-field">
            <select id="areaSelect" class="form-control">
              <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</option>
            </select>
          </div>
        </div>
        
        <div id="diskTurningSection" class="form-section hidden">
          <h3 class="section-title">Ù…Ø®Ø±Ø·Ø© Ø¯ÙŠØ³ÙƒØ§Øª</h3>
          <div class="btn-grid" style="grid-template-columns: 1fr 1fr;">
            <button class="btn-option active" data-disk="no">Ù„Ø§</button>
            <button class="btn-option" data-disk="yes">Ù†Ø¹Ù… (+5 Ø¯.Ùƒ)</button>
          </div>
        </div>
        
        <div id="mechResultSection" class="data-table-container hidden">
          <div class="table-header">Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</div>
          <div class="table-scroll">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                  <th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th>
                </tr>
              </thead>
              <tbody id="mechResultBody">
              </tbody>
            </table>
          </div>
          <div id="mechNote" class="info-box hidden"></div>
        </div>
      `;
      
      document.querySelectorAll('[data-mech]').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('[data-mech]').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          
          formData.mechanicalService = btn.dataset.mech;
          
          document.getElementById('mechAreaSection').classList.remove('hidden');
          
          if (formData.mechanicalService === 'inspection') {
            document.getElementById('diskTurningSection').classList.add('hidden');
            loadAreaOptions('Ø®Ø¯Ù…Ø§Øª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©', [0, 1, 2, 4, 5, 6], calculateMechanicalPrice);
          } else if (formData.mechanicalService === 'oil') {
            document.getElementById('diskTurningSection').classList.add('hidden');
            loadAreaOptions('Ø®Ø¯Ù…Ø§Øª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©', [8, 9, 10, 12, 13, 14], calculateMechanicalPrice);
          } else if (formData.mechanicalService === 'brakes') {
            document.getElementById('diskTurningSection').classList.remove('hidden');
            formData.diskTurning = 'no';
            
            document.querySelectorAll('[data-disk]').forEach(diskBtn => {
              diskBtn.addEventListener('click', () => {
                document.querySelectorAll('[data-disk]').forEach(b => b.classList.remove('active'));
                diskBtn.classList.add('active');
                
                formData.diskTurning = diskBtn.dataset.disk;
                calculateMechanicalPrice();
              });
            });
            
            loadAreaOptions('Ø®Ø¯Ù…Ø§Øª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©', [16, 17, 18, 20, 21, 22], calculateMechanicalPrice);
          }
        });
      });
    }

    function calculateMechanicalPrice() {
      const rows = sheetsData['Ø®Ø¯Ù…Ø§Øª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©'];
      if (!rows) return;
      
      let columns;
      if (formData.mechanicalService === 'inspection') {
        columns = [0, 1, 2, 4, 5, 6];
      } else if (formData.mechanicalService === 'oil') {
        columns = [8, 9, 10, 12, 13, 14];
      } else {
        columns = [16, 17, 18, 20, 21, 22];
      }
      
      let basePrice = 0;
      let cancellation = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
      
      for (let i = 2; i < rows.length; i++) {
        const row = rows[i];
        if (row[columns[0]] === formData.area) {
          basePrice = parseFloat(row[columns[1]]) || 0;
          cancellation = row[columns[2]] ? `${parseFloat(row[columns[2]]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
          break;
        } else if (row[columns[3]] === formData.area) {
          basePrice = parseFloat(row[columns[4]]) || 0;
          cancellation = row[columns[5]] ? `${parseFloat(row[columns[5]]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
          break;
        }
      }
      
      const tbody = document.getElementById('mechResultBody');
      const noteDiv = document.getElementById('mechNote');
      
      if (formData.mechanicalService === 'brakes' && formData.diskTurning === 'yes') {
        const total = basePrice + 5;
        
        tbody.innerHTML = `
          <tr>
            <td>Ø³Ø¹Ø± Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</td>
            <td class="highlight">${basePrice.toFixed(2)} ${config.currency}</td>
          </tr>
          <tr>
            <td>Ù…Ø®Ø±Ø·Ø© Ø¯ÙŠØ³ÙƒØ§Øª</td>
            <td class="highlight">5.00 ${config.currency}</td>
          </tr>
          <tr style="background: #262626;">
            <td><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</strong></td>
            <td class="highlight"><strong>${total.toFixed(2)} ${config.currency}</strong></td>
          </tr>
          <tr>
            <td>Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</td>
            <td>${cancellation}</td>
          </tr>
        `;
      } else {
        tbody.innerHTML = `
          <tr>
            <td>Ø³Ø¹Ø± Ø§Ù„Ø®Ø¯Ù…Ø©</td>
            <td class="highlight">${basePrice.toFixed(2)} ${config.currency}</td>
          </tr>
          <tr>
            <td>Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</td>
            <td>${cancellation}</td>
          </tr>
        `;
      }
      
      if (formData.mechanicalService === 'oil') {
        noteDiv.textContent = 'Ø¥Ø°Ø§ Ø§Ù„Ø²ÙŠØª ÙˆØ§Ù„ÙÙ„ØªØ± Ù…Ù† Ø¹Ù†Ø¯ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙÙ‚Ø·';
        noteDiv.classList.remove('hidden');
      } else if (formData.mechanicalService === 'brakes') {
        noteDiv.textContent = 'Ø¥Ø°Ø§ Ø§Ù„Ù‚Ø·Ø¹ Ù…Ù† Ø¹Ù†Ø¯ Ø§Ù„Ø¹Ù…ÙŠÙ„';
        noteDiv.classList.remove('hidden');
      } else {
        noteDiv.classList.add('hidden');
      }
      
      document.getElementById('mechResultSection').classList.remove('hidden');
    }

    // Render Car Wash Interface
    function renderCarWashInterface() {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <div class="form-section">
          <h3 class="section-title">Ù†ÙˆØ¹ Ø§Ù„ØºØ³ÙŠÙ„</h3>
          <div class="btn-grid" style="grid-template-columns: repeat(4, 1fr);">
            <button class="btn-option" data-wash="premium">ØºØ³ÙŠÙ„ Ù…Ù…ØªØ§Ø²</button>
            <button class="btn-option" data-wash="special">ØºØ³ÙŠÙ„ Ø®ØµÙˆØµÙŠ</button>
            <button class="btn-option" data-wash="ultra">ØºØ³ÙŠÙ„ Ø£Ù„ØªØ±Ø§</button>
            <button class="btn-option" data-wash="all">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</button>
          </div>
        </div>
        
        <div id="washCardsSection" class="form-section full-width hidden">
          <h3 class="section-title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª</h3>
          <div class="wash-cards-grid" id="washCardsGrid">
          </div>
        </div>
        
        <div id="appointmentSection" class="form-section full-width hidden">
          <h3 class="section-title">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ¹Ø¯</h3>
          <div class="form-field">
            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙˆØ¹Ø¯</label>
            <input type="date" id="appointmentDate" class="form-control" style="max-width: 250px;">
          </div>
          <div id="availableSlots" style="margin-top: 12px;"></div>
        </div>
      `;
      
      document.querySelectorAll('[data-wash]').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('[data-wash]').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          
          const washType = btn.dataset.wash;
          handleWashTypeSelection(washType);
        });
      });
    }

    function handleWashTypeSelection(quality) {
      const washCardsSection = document.getElementById('washCardsSection');
      const washCardsGrid = document.getElementById('washCardsGrid');
      
      if (!quality) {
        washCardsSection.classList.add('hidden');
        document.getElementById('appointmentSection').classList.add('hidden');
        return;
      }
      
      washCardsGrid.innerHTML = '';
      
      const washDetails = {
        premium: {
          name: 'â­ ØºØ³ÙŠÙ„ Ù…Ù…ØªØ§Ø²',
          duration: '1 Ø³Ø§Ø¹Ø©',
          priceSedan: 7,
          priceSUV: 8,
          services: ['ØºØ³ÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ', 'ØªÙ†Ø¸ÙŠÙ Ø¯Ø§Ø®Ù„ÙŠ', 'ØªÙ„Ù…ÙŠØ¹ Ø§Ù„ØªÙˆØ§ÙŠØ± ÙˆØ§Ù„Ø±Ù†Ù‚Ø§Øª', 'ØªÙ†Ø¸ÙŠÙ ÙØªØ­Ø§Øª Ø§Ù„ØªÙƒÙŠÙŠÙ', 'Ø¹Ø·Ø±']
        },
        special: {
          name: 'ğŸ’ ØºØ³ÙŠÙ„ Ø®ØµÙˆØµÙŠ',
          duration: 'Ø³Ø§Ø¹ØªÙŠÙ†',
          priceSedan: 15,
          priceSUV: 17,
          services: ['ØºØ³ÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ', 'ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', 'ØªÙ„Ù…ÙŠØ¹ Ø¯ÙŠÙƒÙˆØ±Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©', 'Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¨Ù‚Ø¹ Ø§Ù„Ø®ÙÙŠÙØ©', 'ØªÙ„Ù…ÙŠØ¹ Ø§Ù„ØªÙˆØ§ÙŠØ± ÙˆØ§Ù„Ø±Ù†Ù‚Ø§Øª', 'ØªÙ†Ø¸ÙŠÙ ÙØªØ­Ø§Øª Ø§Ù„ØªÙƒÙŠÙŠÙ', 'Ø¹Ø·Ø±']
        },
        ultra: {
          name: 'ğŸ‘‘ ØºØ³ÙŠÙ„ Ø£Ù„ØªØ±Ø§',
          duration: '3 Ø³Ø§Ø¹Ø§Øª',
          priceSedan: 30,
          priceSUV: 35,
          services: ['ØºØ³ÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ', 'Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', 'ØªÙ„Ù…ÙŠØ¹ Ø¯ÙŠÙƒÙˆØ±Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©', 'ØºØ³ÙŠÙ„ Ù…Ù‚Ø§Ø¹Ø¯ Ø§Ù„Ø³ÙŠØ§Ø±Ø©', 'ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨', 'ØºØ³ÙŠÙ„ Ø¯Ø¨Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©', 'ØªÙ†Ø¸ÙŠÙ Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©']
        }
      };
      
      const washTypes = quality === 'all' ? ['premium', 'special', 'ultra'] : [quality];
      
      washTypes.forEach(type => {
        const wash = washDetails[type];
        washCardsGrid.innerHTML += `
          <div class="wash-card-compact">
            <h3>${wash.name}</h3>
            <div class="price">ØµØ§Ù„ÙˆÙ†: ${wash.priceSedan} Ø¯.Ùƒ | Ø¬ÙŠØ¨: ${wash.priceSUV} Ø¯.Ùƒ</div>
            <div style="font-size: 11px; color: #10b981; margin-bottom: 6px;">â± ${wash.duration}</div>
            <ul>
              ${wash.services.slice(0, 4).map(s => `<li>${s}</li>`).join('')}
            </ul>
            <button class="copy-btn-small" onclick="copyWashDetails('${type}')">ğŸ“‹ Ù†Ø³Ø®</button>
          </div>
        `;
      });
      
      formData.selectedWashes = washTypes;
      washCardsSection.classList.remove('hidden');
      document.getElementById('appointmentSection').classList.remove('hidden');
      
      const appointmentDate = document.getElementById('appointmentDate');
      const today = new Date().toISOString().split('T')[0];
      appointmentDate.min = today;
      appointmentDate.value = today;
      
      loadCarWashAppointments(today);
      
      appointmentDate.addEventListener('change', () => {
        loadCarWashAppointments(appointmentDate.value);
      });
    }

    window.copyWashDetails = async function(type) {
      const washDetails = {
        premium: {
          name: 'ØºØ³ÙŠÙ„ Ù…Ù…ØªØ§Ø²',
          duration: 'Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø©',
          priceSedan: 7,
          priceSUV: 8,
          services: ['ØºØ³ÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ', 'ØªÙ†Ø¸ÙŠÙ Ø¯Ø§Ø®Ù„ÙŠ', 'ØªÙ„Ù…ÙŠØ¹ Ø§Ù„ØªÙˆØ§ÙŠØ± ÙˆØ§Ù„Ø±Ù†Ù‚Ø§Øª', 'ØªÙ†Ø¸ÙŠÙ ÙØªØ­Ø§Øª Ø§Ù„ØªÙƒÙŠÙŠÙ', 'Ø¹Ø·Ø±']
        },
        special: {
          name: 'ØºØ³ÙŠÙ„ Ø®ØµÙˆØµÙŠ',
          duration: 'Ø³Ø§Ø¹ØªÙŠÙ†',
          priceSedan: 15,
          priceSUV: 17,
          services: ['ØºØ³ÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ', 'ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', 'ØªÙ„Ù…ÙŠØ¹ Ø¯ÙŠÙƒÙˆØ±Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©', 'Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¨Ù‚Ø¹ Ø§Ù„Ø®ÙÙŠÙØ©', 'ØªÙ„Ù…ÙŠØ¹ Ø§Ù„ØªÙˆØ§ÙŠØ± ÙˆØ§Ù„Ø±Ù†Ù‚Ø§Øª', 'ØªÙ†Ø¸ÙŠÙ ÙØªØ­Ø§Øª Ø§Ù„ØªÙƒÙŠÙŠÙ', 'Ø¹Ø·Ø±']
        },
        ultra: {
          name: 'ØºØ³ÙŠÙ„ Ø£Ù„ØªØ±Ø§',
          duration: '3 Ø³Ø§Ø¹Ø§Øª',
          priceSedan: 30,
          priceSUV: 35,
          services: ['ØºØ³ÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ', 'Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', 'ØªÙ„Ù…ÙŠØ¹ Ø¯ÙŠÙƒÙˆØ±Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©', 'ØºØ³ÙŠÙ„ Ù…Ù‚Ø§Ø¹Ø¯ Ø§Ù„Ø³ÙŠØ§Ø±Ø©', 'ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨', 'ØºØ³ÙŠÙ„ Ø¯Ø¨Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©', 'ØªÙ†Ø¸ÙŠÙ Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©']
        }
      };
      
      const wash = washDetails[type];
      const text = `
${wash.name}
Ù…Ø¯Ø© Ø§Ù„ØºØ³ÙŠÙ„: ${wash.duration}

Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:
â€¢ ØµØ§Ù„ÙˆÙ†: ${wash.priceSedan} Ø¯.Ùƒ
â€¢ Ø¬ÙŠØ¨: ${wash.priceSUV} Ø¯.Ùƒ

Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø´Ù…ÙˆÙ„Ø©:
${wash.services.map(s => `â€¢ ${s}`).join('\n')}
      `.trim();
      
      try {
        await navigator.clipboard.writeText(text);
        
        const buttons = document.querySelectorAll('.copy-btn-small');
        buttons.forEach(btn => {
          if (btn.onclick && btn.onclick.toString().includes(type)) {
            btn.classList.add('success');
            btn.textContent = 'âœ“ ØªÙ… Ø§Ù„Ù†Ø³Ø®!';
            
            setTimeout(() => {
              btn.classList.remove('success');
              btn.textContent = 'ğŸ“‹ Ù†Ø³Ø®';
            }, 2000);
          }
        });
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    };

    async function loadCarWashAppointments(selectedDate) {
      try {
        const sheetId = '1FkWKRxRFC8UG1Ez2VzYHadHju2HARBLbdTIsr57hKXc';
        const csvUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=Sheet1`;
        
        const response = await fetch(csvUrl);
        if (!response.ok) throw new Error('Failed to load');
        
        const csvText = await response.text();
        const rows = parseCSV(csvText);
        
        carWashData = [];
        
        for (let i = 1; i < rows.length; i++) {
          const row = rows[i];
          if (row[0] && row[1]) {
            let parsedDate = row[0].trim();
            const dateObj = new Date(parsedDate);
            if (!isNaN(dateObj.getTime())) {
              const year = dateObj.getFullYear();
              const month = String(dateObj.getMonth() + 1).padStart(2, '0');
              const day = String(dateObj.getDate()).padStart(2, '0');
              parsedDate = `${year}-${month}-${day}`;
            }
            
            let timeStr = row[1].trim();
            let hours = 0;
            let minutes = 0;
            
            const hasAMPM = /am|pm/i.test(timeStr);
            
            if (hasAMPM) {
              const isPM = /pm/i.test(timeStr);
              timeStr = timeStr.replace(/am|pm/gi, '').trim();
              
              const timeParts = timeStr.split(':');
              hours = parseInt(timeParts[0]) || 0;
              minutes = parseInt(timeParts[1]) || 0;
              
              if (isPM && hours !== 12) {
                hours += 12;
              } else if (!isPM && hours === 12) {
                hours = 0;
              }
            } else {
              const timeParts = timeStr.split(':');
              hours = parseInt(timeParts[0]) || 0;
              minutes = parseInt(timeParts[1]) || 0;
            }
            
            const formattedTime = `${hours}:${String(minutes).padStart(2, '0')}`;
            
            carWashData.push({
              date: parsedDate,
              time: formattedTime,
              customerName: row[3] || '',
              washType: row[6] || ''
            });
          }
        }
        
        calculateAvailableSlots(selectedDate);
        
      } catch (error) {
        document.getElementById('availableSlots').innerHTML = `
          <div class="error-box">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</div>
        `;
      }
    }

    function calculateAvailableSlots(selectedDate) {
      const availableSlots = document.getElementById('availableSlots');
      
      const dateObj = new Date(selectedDate + 'T00:00:00');
      const dayOfWeek = dateObj.toLocaleDateString('ar-EG', { weekday: 'long' });
      const formattedDate = dateObj.toLocaleDateString('ar-EG', { year: 'numeric', month: 'long', day: 'numeric' });
      
      const dayIndex = dateObj.getDay();
      const startOfYear = new Date(dateObj.getFullYear(), 0, 1);
      const days = Math.floor((dateObj - startOfYear) / (24 * 60 * 60 * 1000));
      const weekNumber = Math.ceil((days + startOfYear.getDay() + 1) / 7);
      
      if (dayIndex === 5 && weekNumber % 2 === 1) {
        availableSlots.innerHTML = `
          <div class="error-box">
            <strong>âŒ Ù…ØºÙ„Ù‚ ÙŠÙˆÙ… Ø§Ù„Ø¬Ù…Ø¹Ø©</strong><br>
            Ø£Ù‚Ø±Ø¨ Ù…ÙˆØ¹Ø¯ Ù…ØªØ§Ø­: ÙŠÙˆÙ… Ø§Ù„Ø³Ø¨Øª
          </div>
        `;
        return;
      }
      
      const todayAppointments = carWashData.filter(apt => apt.date === selectedDate);
      todayAppointments.sort((a, b) => {
        const timeA = a.time.split(':').map(Number);
        const timeB = b.time.split(':').map(Number);
        return (timeA[0] * 60 + timeA[1]) - (timeB[0] * 60 + timeB[1]);
      });
      
      let html = `
        <div style="background: #1a1a1a; border: 1px solid #F2BC1B; padding: 10px; border-radius: 6px; margin-bottom: 10px;">
          <div style="font-size: 13px; font-weight: 700; color: #F2BC1B;">${dayOfWeek}</div>
          <div style="font-size: 12px; color: #999;">${formattedDate}</div>
        </div>
      `;
      
      const workStartMinutes = 630; // 10:30 AM
      const workEndMinutes = 1320; // 10:00 PM
      
      let nextAvailableTime = workStartMinutes;
      
      const today = new Date();
      const isToday = dateObj.getDate() === today.getDate() && 
                      dateObj.getMonth() === today.getMonth() && 
                      dateObj.getFullYear() === today.getFullYear();
      
      if (isToday) {
        const currentMinutes = today.getHours() * 60 + today.getMinutes();
        const roundedMinutes = Math.ceil((currentMinutes + 30) / 5) * 5;
        nextAvailableTime = Math.max(nextAvailableTime, roundedMinutes);
      }
      
      if (todayAppointments.length === 0) {
        const hours = Math.floor(nextAvailableTime / 60);
        const minutes = nextAvailableTime % 60;
        const period = hours >= 12 ? 'Ù…Ø³Ø§Ø¡Ù‹' : 'ØµØ¨Ø§Ø­Ø§Ù‹';
        const displayHours = hours > 12 ? hours - 12 : hours;
        const displayTime = `${displayHours}:${minutes.toString().padStart(2, '0')} ${period}`;
        
        html += `
          <div class="info-box" style="background: #1a4a2a; border-color: #10b981;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div style="color: #10b981;"><strong>âœ“ Ø£Ù‚Ø±Ø¨ Ù…ÙˆØ¹Ø¯ Ù…ØªØ§Ø­</strong></div>
              <div style="font-size: 16px; font-weight: 700; color: #10b981;">${displayTime}</div>
            </div>
          </div>
        `;
      } else {
        for (let i = 0; i < todayAppointments.length; i++) {
          const apt = todayAppointments[i];
          const timeParts = apt.time.split(':').map(Number);
          let appointmentMinutes = timeParts[0] * 60 + timeParts[1];
          
          let washDuration = 60;
          const washType = apt.washType.toLowerCase();
          if (washType.includes('Ø®ØµÙˆØµÙŠ')) washDuration = 120;
          else if (washType.includes('Ø§Ù„ØªØ±Ø§')) washDuration = 180;
          
          const endTime = appointmentMinutes + washDuration + 30;
          if (endTime > nextAvailableTime) {
            nextAvailableTime = endTime;
          }
        }
        
        const remainder = nextAvailableTime % 5;
        if (remainder !== 0) {
          nextAvailableTime = nextAvailableTime + (5 - remainder);
        }
        
        const hours = Math.floor(nextAvailableTime / 60);
        const minutes = nextAvailableTime % 60;
        const period = hours >= 12 ? 'Ù…Ø³Ø§Ø¡Ù‹' : 'ØµØ¨Ø§Ø­Ø§Ù‹';
        const displayHours = hours > 12 ? hours - 12 : hours;
        const displayTime = `${displayHours}:${minutes.toString().padStart(2, '0')} ${period}`;
        
        if (nextAvailableTime >= workEndMinutes) {
          html += `
            <div class="warning-box">
              <strong>âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆÙ‚Øª ÙƒØ§ÙÙ Ø§Ù„ÙŠÙˆÙ…</strong><br>
              Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ ØªÙ†ØªÙ‡ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø© 10:00 Ù…Ø³Ø§Ø¡Ù‹
            </div>
          `;
        } else {
          html += `
            <div class="info-box" style="background: #1a4a2a; border-color: #10b981;">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="color: #10b981;"><strong>âœ“ Ø£Ù‚Ø±Ø¨ Ù…ÙˆØ¹Ø¯ Ù…ØªØ§Ø­</strong></div>
                <div style="font-size: 16px; font-weight: 700; color: #10b981;">${displayTime}</div>
              </div>
            </div>
          `;
        }
        
        if (todayAppointments.length > 0) {
          html += `<div style="margin-top: 12px; font-size: 12px; font-weight: 700; color: #F2BC1B; margin-bottom: 8px;">Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø©:</div>`;
          
          todayAppointments.forEach((apt) => {
            const timeParts = apt.time.split(':').map(Number);
            const hours = timeParts[0];
            const minutes = timeParts[1];
            const period = hours >= 12 ? 'Ù…Ø³Ø§Ø¡Ù‹' : 'ØµØ¨Ø§Ø­Ø§Ù‹';
            const displayHours = hours > 12 ? hours - 12 : hours;
            const displayTime = `${displayHours}:${minutes.toString().padStart(2, '0')} ${period}`;
            
            html += `
              <div style="background: #262626; border: 1px solid #404040; padding: 8px; border-radius: 4px; margin-bottom: 6px;">
                <div style="display: flex; justify-content: space-between; align-items: center; font-size: 12px;">
                  <div>
                    <div style="color: #fff; font-weight: 600; margin-bottom: 2px;">${displayTime}</div>
                    <div style="color: #999;">${apt.customerName || 'Ø¹Ù…ÙŠÙ„'}</div>
                  </div>
                  <div style="background: #F2BC1B; color: #000; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">${apt.washType}</div>
                </div>
              </div>
            `;
          });
        }
      }
      
      availableSlots.innerHTML = html;
    }

    // Generic Service Interface Renderer
    function renderServiceInterface(title, sheetName, columns, note = '') {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <div class="form-section full-width">
          <h3 class="section-title">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</h3>
          <div class="form-field">
            <select id="areaSelect" class="form-control">
              <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</option>
            </select>
          </div>
          ${note}
        </div>
        
        <div id="serviceResultSection" class="data-table-container hidden">
          <div class="table-header">${title}</div>
          <div class="table-scroll">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                  <th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th>
                </tr>
              </thead>
              <tbody id="serviceResultBody">
              </tbody>
            </table>
          </div>
        </div>
      `;
      
      loadAreaOptions(sheetName, columns, () => {
        calculateServicePrice(sheetName, columns);
      });
    }

    function loadAreaOptions(sheetName, columns, callback) {
      const areaSelect = document.getElementById('areaSelect');
      
      if (!sheetsData[sheetName]) {
        areaSelect.innerHTML = '<option value="">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</option>';
        return;
      }
      
      const rows = sheetsData[sheetName];
      const areas = [];
      
      for (let i = 2; i < rows.length; i++) {
        const row = rows[i];
        columns.forEach((colIndex, idx) => {
          if (idx % 3 === 0 && row[colIndex]) {
            areas.push(row[colIndex]);
          }
        });
      }
      
      const uniqueAreas = [...new Set(areas)].filter(Boolean);
      
      areaSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</option>' + 
        uniqueAreas.map(area => `<option value="${area}">${area}</option>`).join('');
      
      areaSelect.addEventListener('change', () => {
        formData.area = areaSelect.value;
        if (formData.area && callback) {
          callback();
        }
      });
    }

    function calculateServicePrice(sheetName, columns) {
      const rows = sheetsData[sheetName];
      if (!rows) return;
      
      let price = null;
      let cancellation = null;
      
      for (let i = 2; i < rows.length; i++) {
        const row = rows[i];
        
        if (row[columns[0]] === formData.area) {
          price = row[columns[1]];
          cancellation = row[columns[2]];
          break;
        }
        
        if (columns.length > 3 && row[columns[3]] === formData.area) {
          price = row[columns[4]];
          cancellation = row[columns[5]];
          break;
        }
      }
      
      if (!price) return;
      
      const tbody = document.getElementById('serviceResultBody');
      tbody.innerHTML = `
        <tr>
          <td>Ø³Ø¹Ø± Ø§Ù„Ø®Ø¯Ù…Ø©</td>
          <td class="highlight">${parseFloat(price).toFixed(2)} ${config.currency}</td>
        </tr>
        <tr>
          <td>Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</td>
          <td>${cancellation ? parseFloat(cancellation).toFixed(2) + ' ' + config.currency : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
        </tr>
      `;
      
      document.getElementById('serviceResultSection').classList.remove('hidden');
    }

    // Initial load
    loadAllSheets();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b2824b6048c51ca',t:'MTc2NjQ5NTg5MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
